<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-sclae=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <!--bootstrap integration-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!--other css integration-->
    <link rel="stylesheet" href="rowStyle.css">

    <title>Dashboard</title>
</head>
<body>

<main class="container-fluid">

</main>

<!--scripting-->
<!--jquery integration-->
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>


<script>
    let cards = document.getElementsByClassName('card');
    let sensorString = "sensor";
    let dateString = "date";
    let temperatureString = "temperature";
    let humidityString = "humidity";
    let luminosityString = "luminosity";
    let distanceString = "distance";

    $(document).ready(function () {
        $.getJSON("testData.json", function (data) {
            data.sort(SortBySensor);
            let sensorArray = BuildSensorArray(data);
            GenerateHTML(sensorArray);
        });
    });

    /*
    $(cards).click(function () {
        console.log('Card ' + this.id + ' has been clicked!');
    });
    */

    /**
     * @return {number}
     */
    function SortBySensor(a, b) {
        let aSensor = a[sensorString];
        let bSensor = b[sensorString];
        return ((aSensor < bSensor) ? -1 : ((aSensor > bSensor) ? 1 : 0));
    }

    function BuildSensorArray(array){
        if (Array.isArray(array)){
            let sensorArray = [];
            sensorArray.push(array[0]);
            let i;
            let j = 0;
            let k;
            let l = 0;

            for (i = 0; i < array.length - 1; i++){
                if (array[i][sensorString] === array[i + 1][sensorString] && array[i + 1] !== array[array.length - 1]){
                    j++;
                } else if (array[i + 1] !== array[array.length - 1]){
                    for (k = i - j; k < i; k++){
                        if (array[k][dateString] > sensorArray[l][dateString]){
                            sensorArray[l] = array[k];
                        }
                    }

                    sensorArray.push(array[i+1]);
                    j = 0;
                    l++;
                } else {
                    for (let k = i - j; k < i; k++){
                        if (array[k][dateString] > sensorArray[l][dateString]){
                            sensorArray[l] = array[k];
                        }
                    }
                }
            }

            return sensorArray;
        }
    }

    function GenerateHTML(array) {
        if (Array.isArray(array)) {
            let htmlString = "";

            for (let i = 0; i < array.length; i++) {
                if (i % 4 === 0 || i === 0) {
                    htmlString += "<div class='row'>";
                }

                htmlString += "<div class='col-3'>" +
                    "   <div class='card' id='card_" + i + "'>" +
                    "       <div class='card-header'>" +
                    "           <span>Sensor " + array[i][sensorString] + "</span>" +
                    "       </div> " +
                    "       <div class='card-body'>" +
                    "           <div class='row'>" +
                    "               <div class='col-3'>" +
                    "                   <label for='tempField'>Temperature</label>" +
                    "               </div>" +
                    "               <div class='col-3'>" +
                    "                   <span id='tempField'>" + array[i][temperatureString] + "</span>" +
                    "               </div>" +
                    "               <div class='col-3'>" +
                    "                   <label for='distField'>Distance</label>" +
                    "               </div>" +
                    "               <div class='col-3'>" +
                    "                   <span id='distField'>" + array[i][distanceString] + "</span>" +
                    "               </div>" +
                    "           </div>" +
                    "           <div class='row'>" +
                    "               <div class='col-3'>" +
                    "                   <label for='humiField'>Humidity</label>" +
                    "               </div>" +
                    "               <div class='col-3'>" +
                    "                   <span id='humiField'>" + array[i][humidityString] + "</span>" +
                    "               </div>" +
                    "               <div class='col-3'>" +
                    "                   <label for='lumiField'>Luminosity</label>" +
                    "               </div>" +
                    "               <div class='col-3'>" +
                    "                   <span id='lumiField'>" + array[i][luminosityString] + "</span>" +
                    "               </div>" +
                    "           </div>" +
                    "       </div>" +
                    "       <div class='card-footer'>" +
                    "           <span>" + array[i][dateString] + "</span>" +
                    "       </div>" +
                    "   </div> " +
                    "</div>";

                if (i % 4 === 3 || i === array.length - 1) {
                    htmlString += "</div>";
                }
            }

            $("main").append(htmlString);
        }
    }

</script>

</body>
</html>